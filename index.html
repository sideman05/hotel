<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxury Haven Hotel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-container">
            <a href="#" class="logo">Luxury<span>Haven</span></a>
            <nav>
                <ul>
                    <li><a href="#" class="nav-home">Home</a></li>
                    <li><a href="#" class="nav-rooms">Rooms</a></li>
                    <li><a href="#" class="nav-amenities">Amenities</a></li>
                    <li><a href="#" class="nav-gallery">Gallery</a></li>
                    <li><a href="#" class="nav-contact">Contact</a></li>
                    <li><a href="#" class="btn nav-book">Book Now</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container hero-content">
            <h1>Experience Luxury & Comfort</h1>
            <p>Discover a world of elegance and exceptional hospitality at Luxury Haven Hotel</p>
            <a href="#" class="btn">Explore Our Rooms</a>
            
            <div class="booking-widget">
                <div class="booking-form">
                    <div class="form-group">
                        <label for="check-in">Check In</label>
                        <input type="date" id="check-in">
                    </div>
                    <div class="form-group">
                        <label for="check-out">Check Out</label>
                        <input type="date" id="check-out">
                    </div>
                    <div class="form-group">
                        <label for="guests">Guests</label>
                        <select id="guests">
                            <option>1 Adult</option>
                            <option>2 Adults</option>
                            <option>3 Adults</option>
                            <option>4 Adults</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="room-type">Room Type</label>
                        <select id="room-type">
                            <option>Standard Room</option>
                            <option>Deluxe Room</option>
                            <option>Executive Suite</option>
                            <option>Presidential Suite</option>
                        </select>
                    </div>
                    <div class="form-group form-btn">
                        <button class="btn">Check Availability</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="about">
        <div class="container">
            <div class="section-title">
                <h2>Welcome to Luxury Haven</h2>
                <p>Where exceptional experiences begin</p>
            </div>
            
            <div class="about-content">
                <div class="about-text">
                    <h2>Discover Our Story</h2>
                    <p>Luxury Haven Hotel offers a unique blend of contemporary design and traditional hospitality. Located in the heart of the city, we provide easy access to business districts, shopping areas, and cultural attractions.</p>
                    <p>Our hotel features 120 beautifully appointed guest rooms and suites, a world-class restaurant, a fully equipped fitness center, and versatile meeting spaces for business and social events.</p>
                    <p>Whether you're traveling for business or leisure, our dedicated team is committed to providing you with an unforgettable stay characterized by warm service and attention to detail.</p>
                    <a href="#" class="btn">Learn More</a>
                </div>
                <div class="about-image">
                    <img src="https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400&q=80" alt="Hotel Lobby">
                </div>
            </div>
        </div>
    </section>

    <!-- Rooms Section -->
    <section class="rooms">
        <div class="container">
            <div class="section-title">
                <h2>Our Rooms & Suites</h2>
                <p>Designed for your comfort and relaxation</p>
            </div>
            <div class="rooms-container" id="homepageRoomsContainer">
                <!-- Dynamic rooms will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Amenities Section -->
    <section class="amenities">
        <div class="container">
            <div class="section-title">
                <h2>Hotel Amenities</h2>
                <p>Enhancing your stay with premium facilities</p>
            </div>
            <div class="amenities-filter-buttons" style="text-align:center;margin-bottom:20px;">
                <button class="btn btn-outline-primary active" data-filter="all">All</button>
                <button class="btn btn-outline-primary" data-filter="room">Room Amenities</button>
                <button class="btn btn-outline-primary" data-filter="bathroom">Bathroom</button>
                <button class="btn btn-outline-primary" data-filter="food">Food & Beverage</button>
                <button class="btn btn-outline-primary" data-filter="recreation">Recreation</button>
                <button class="btn btn-outline-primary" data-filter="business">Business Services</button>
                <button class="btn btn-outline-primary" data-filter="general">General</button>
            </div>
            <div class="amenities-container" id="homepageAmenitiesContainer">
                <!-- Dynamic amenities will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    <!-- Gallery Section -->
    <section class="gallery">
        <div class="container">
            <div class="section-title">
                <h2>Gallery</h2>
                <p>See our beautiful hotel and amenities</p>
            </div>
            <div class="filter-buttons" style="text-align:center;margin-bottom:20px;">
                <button class="btn btn-outline-primary active" data-filter="all">All Images</button>
                <button class="btn btn-outline-primary" data-filter="rooms">Rooms</button>
                <button class="btn btn-outline-primary" data-filter="dining">Dining</button>
                <button class="btn btn-outline-primary" data-filter="amenities">Amenities</button>
                <button class="btn btn-outline-primary" data-filter="events">Events</button>
                <button class="btn btn-outline-primary" data-filter="exterior">Exterior</button>
            </div>
            <div class="gallery-container" id="homepageGalleryContainer" style="display:flex;flex-wrap:wrap;gap:20px;justify-content:center;">
                <!-- Dynamic gallery images will be loaded here -->
            </div>
        </div>
        <!-- Image Preview Modal -->
        <div id="galleryPreviewModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);z-index:9999;align-items:center;justify-content:center;">
            <div style="background:#fff;padding:20px;max-width:500px;width:90vw;max-height:90vh;overflow:auto;position:relative;border-radius:8px;text-align:center;">
                <button id="closeGalleryPreviewModal" style="position:absolute;top:10px;right:10px;font-size:22px;background:none;border:none;">&times;</button>
                <img id="galleryPreviewImg" src="" alt="Preview" style="width:100%;max-height:300px;object-fit:contain;border-radius:6px;box-shadow:0 2px 8px #0001;">
                <div style="font-weight:600;margin-top:12px;" id="galleryPreviewTitle"></div>
                <div style="font-size:13px;color:#888;" id="galleryPreviewDesc"></div>
            </div>
        </div>
    </section>
    <section class="testimonials">
        <div class="container testimonials-container">
            <div class="section-title">
                <h2>Guest Testimonials</h2>
                <p>What our guests say about us</p>
            </div>
            <div id="homepageTestimonialsContainer">
                <!-- Dynamic testimonials will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="contact">
        <div class="container">
            <div class="section-title">
                <h2>Contact Us</h2>
                <p>We're here to assist you</p>
            </div>
            
            <div class="contact-container">
                <div class="contact-info">
                    <h3>Get In Touch</h3>
                    <ul class="contact-details">
                        <li>
                            <i class="fas fa-map-marker-alt"></i>
                            <div>123 Luxury Avenue, Prestige District<br>City, Country 10001</div>
                        </li>
                        <li>
                            <i class="fas fa-phone"></i>
                            <div>+1 (123) 456-7890</div>
                        </li>
                        <li>
                            <i class="fas fa-envelope"></i>
                            <div>info@luxuryhaven.com</div>
                        </li>
                        <li>
                            <i class="fas fa-clock"></i>
                            <div>Front Desk: 24/7</div>
                        </li>
                    </ul>
                </div>
                
                <div class="contact-form">
                    <form>
                        <input type="text" class="form-input" placeholder="Your Name" required>
                        <input type="email" class="form-input" placeholder="Your Email" required>
                        <input type="text" class="form-input" placeholder="Subject">
                        <textarea class="form-input" placeholder="Your Message" required></textarea>
                        <button type="submit" class="btn">Send Message</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container footer-container">
            <div class="footer-col">
                <h4>Luxury Haven Hotel</h4>
                <p>Experience the epitome of luxury and comfort with our exceptional hospitality and world-class amenities.</p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
            
            <div class="footer-col">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#">Rooms & Suites</a></li>
                    <li><a href="#">Dining</a></li>
                    <li><a href="#">Spa & Wellness</a></li>
                    <li><a href="#">Special Offers</a></li>
                </ul>
            </div>
            
            <div class="footer-col">
                <h4>Support</h4>
                <ul>
                    <li><a href="#">FAQs</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms & Conditions</a></li>
                    <li><a href="#">Cancellation Policy</a></li>
                    <li><a href="#">Accessibility</a></li>
                </ul>
            </div>
            
            <div class="footer-col">
                <h4>Newsletter</h4>
                <p>Subscribe to our newsletter for exclusive offers and updates.</p>
                <form>
                    <input type="email" class="form-input" placeholder="Your Email" required>
                    <button type="submit" class="btn">Subscribe</button>
                </form>
            </div>
        </div>
        
        <div class="container copyright">
            <p>&copy; 2023 Luxury Haven Hotel. All Rights Reserved.</p>
        </div>
    </footer>

    <script>

        // 4. Dynamic Testimonials
        function renderHomepageTestimonials(testimonials) {
            let html = testimonials.map(t => {
                let avatar = t.avatar ? ('admin/uploads/' + t.avatar) : 'https://randomuser.me/api/portraits/lego/1.jpg';
                let name = t.name || 'Guest';
                let role = t.role || '';
                let text = t.text || t.message || '';
                return `
                <div class="testimonial">
                    <p class="testimonial-text">"${text}"</p>
                    <div class="testimonial-author">
                        <img src="${avatar}" alt="${name}" style="width:40px;height:40px;border-radius:50%;object-fit:cover;margin-right:8px;vertical-align:middle;"> ${name}
                    </div>
                    <div class="testimonial-role">${role}</div>
                </div>
                `;
            }).join('');
            document.getElementById('homepageTestimonialsContainer').innerHTML = html;
        }
        fetch('admin/testimonials_crud.php?action=read')
            .then(res => res.json())
            .then(renderHomepageTestimonials);

        // --- Dynamic Homepage Sections ---
        // 1. Dynamic Rooms
        function renderHomepageRooms(rooms) {
            let html = rooms.map(room => {
                let images = [];
                try { images = JSON.parse(room.images || '[]'); } catch(e) {}
                let imgSrc = images.length ? ('admin/uploads/' + images[0]) : 'https://via.placeholder.com/400x250?text=No+Image';
                let features = [];
                try { features = JSON.parse(room.features || '[]'); } catch(e) {}
                return `
                <div class="room-card">
                    <div class="room-image">
                        <img src="${imgSrc}" alt="${room.name}">
                    </div>
                    <div class="room-details">
                        <h3>${room.name}</h3>
                        <div class="room-price">$${room.price} <span>/night</span></div>
                        <ul class="room-features">
                            ${features.map(f => `<li><i class="fas fa-check"></i> ${f}</li>`).join('')}
                        </ul>
                        <a href="#" class="btn">View Details</a>
                    </div>
                </div>
                `;
            }).join('');
            document.getElementById('homepageRoomsContainer').innerHTML = html;
        }
        fetch('admin/rooms_crud.php?action=read')
            .then(res => res.json())
            .then(renderHomepageRooms);

        // 2. Dynamic Amenities
        // --- Amenities with Categories and Images ---
        let homepageAmenitiesData = [];
        function categoryText(val) {
            switch(val) {
                case 'room': return 'Room Amenities';
                case 'bathroom': return 'Bathroom';
                case 'food': return 'Food & Beverage';
                case 'recreation': return 'Recreation';
                case 'business': return 'Business Services';
                case 'general': return 'General';
                default: return val;
            }
        }
        function renderHomepageAmenities(amenities) {
            homepageAmenitiesData = amenities;
            const activeBtn = document.querySelector('.amenities-filter-buttons button.active');
            const filter = activeBtn ? activeBtn.getAttribute('data-filter') : 'all';
            let filtered = (filter === 'all') ? amenities : amenities.filter(a => a.category === filter);
            let html = filtered.map(a => {
                let icon = a.icon ? `<i class="fas ${a.icon}" style="font-size:2rem;"></i>` : '';
                let img = '';
                if (a.image) {
                    let imgPath = a.image;
                    if (!imgPath.startsWith('admin/uploads/')) {
                        if (imgPath.startsWith('uploads/')) imgPath = 'admin/' + imgPath;
                        else imgPath = 'admin/uploads/' + imgPath;
                    }
                    img = `<img src="${imgPath}" alt="${a.name}" style="width:60px;height:60px;object-fit:cover;border-radius:8px;display:block;margin:0 auto 10px auto;">`;
                }
                return `
                <div class="amenity-item" style="text-align:center;padding:18px 10px;min-width:180px;max-width:220px;margin:0 auto 18px auto;box-shadow:0 2px 8px #0001;border-radius:10px;background:#fff;display:inline-block;vertical-align:top;">
                    ${img}
                    ${icon}
                    <h3 style="font-size:1.1rem;margin:10px 0 5px 0;">${a.name}</h3>
                    <div style="font-size:13px;color:#888;margin-bottom:4px;">${categoryText(a.category)}</div>
                    <p style="font-size:14px;">${a.description}</p>
                </div>
                `;
            }).join('');
            document.getElementById('homepageAmenitiesContainer').innerHTML = html || '<div style="width:100%;text-align:center;color:#888;">No amenities found for this category.</div>';
        }
        fetch('admin/amenities.php?action=read')
            .then(res => res.json())
            .then(renderHomepageAmenities);

        // Amenities filter buttons
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.amenities-filter-buttons button').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.amenities-filter-buttons button').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    renderHomepageAmenities(homepageAmenitiesData);
                });
            });
        });

        // 3. Dynamic Gallery
        // --- Gallery with Categories and Modal Preview ---
        let homepageGalleryImages = [];
        function renderHomepageGallery(images) {
            homepageGalleryImages = images;
            const container = document.getElementById('homepageGalleryContainer');
            const activeBtn = document.querySelector('.filter-buttons button.active');
            const filter = activeBtn ? activeBtn.getAttribute('data-filter') : 'all';
            let filtered = (filter === 'all') ? images : images.filter(img => img.category === filter);
            let html = filtered.map((img, idx) => {
                let src = 'admin/gallery_uploads/' + img.filename;
                let title = img.title || '';
                let desc = img.description || '';
                let cat = img.category ? img.category.charAt(0).toUpperCase() + img.category.slice(1) : '';
                return `
                <div class="gallery-thumb" style="width:220px;text-align:center;cursor:pointer;" data-idx="${img.id}" data-index="${idx}" data-category="${img.category}">
                    <img src="${src}" alt="${title}" style="width:100%;height:140px;object-fit:cover;border-radius:8px;box-shadow:0 2px 8px #0001;">
                    <div style="font-weight:600;margin-top:8px;">${title}</div>
                    <div style="font-size:13px;color:#888;">${desc}</div>
                    <div style="font-size:12px;color:#aaa;">${cat}</div>
                </div>
                `;
            }).join('');
            container.innerHTML = html || '<div style="width:100%;text-align:center;color:#888;">No images found for this category.</div>';
        }
        fetch('admin/gallery_crud.php?action=list')
            .then(res => res.json())
            .then(renderHomepageGallery);

        // Gallery filter buttons
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.filter-buttons button').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-buttons button').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    renderHomepageGallery(homepageGalleryImages);
                });
            });
        });

        // Gallery image preview modal
        document.addEventListener('click', function(e) {
            let thumb = e.target.closest('.gallery-thumb');
            if (thumb) {
                let idx = thumb.getAttribute('data-index');
                let img = homepageGalleryImages[idx];
                if (!img) return;
                document.getElementById('galleryPreviewImg').src = 'admin/gallery_uploads/' + img.filename;
                document.getElementById('galleryPreviewTitle').textContent = img.title || '';
                document.getElementById('galleryPreviewDesc').textContent = img.description || '';
                document.getElementById('galleryPreviewModal').style.display = 'flex';
            }
            if (e.target.id === 'closeGalleryPreviewModal') {
                document.getElementById('galleryPreviewModal').style.display = 'none';
            }
        });
        // Simple JavaScript for header scroll effect
        window.addEventListener('scroll', function() {
            const header = document.querySelector('header');
            if (window.scrollY > 100) {
                header.style.background = 'rgba(255, 255, 255, 0.95)';
                header.style.boxShadow = '0 2px 10px rgba(0, 0, 0, 0.1)';
            } else {
                header.style.background = 'rgba(255, 255, 255, 0.95)';
                header.style.boxShadow = '0 2px 10px rgba(0, 0, 0, 0.1)';
            }
        });

        // Navigation scroll logic
        document.querySelector('.nav-home').addEventListener('click', function(e) {
            e.preventDefault();
            window.scrollTo({top: 0, behavior: 'smooth'});
        });
        document.querySelector('.nav-rooms').addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelector('.rooms').scrollIntoView({behavior:'smooth'});
        });
        document.querySelector('.nav-amenities').addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelector('.amenities').scrollIntoView({behavior:'smooth'});
        });
        document.querySelector('.nav-gallery').addEventListener('click', function(e) {
            e.preventDefault();
            // If you have a gallery section, scroll to it. Otherwise, scroll to rooms as a fallback.
            let gallery = document.querySelector('.gallery');
            if (gallery) gallery.scrollIntoView({behavior:'smooth'});
            else document.querySelector('.rooms').scrollIntoView({behavior:'smooth'});
        });
        document.querySelector('.nav-contact').addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelector('.contact').scrollIntoView({behavior:'smooth'});
        });
        document.querySelector('.nav-book').addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelector('.booking-widget').scrollIntoView({behavior:'smooth'});
        });

        // Set minimum date for check-in to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('check-in').setAttribute('min', today);

        // Set minimum date for check-out to check-in date
        document.getElementById('check-in').addEventListener('change', function() {
            document.getElementById('check-out').setAttribute('min', this.value);
        });


        // --- Booking Flow Logic (fetch from backend) ---
        document.querySelector('.booking-form .btn').addEventListener('click', function(e) {
            e.preventDefault();
            // Get form values
            const checkIn = document.getElementById('check-in').value;
            const checkOut = document.getElementById('check-out').value;
            const guests = document.getElementById('guests').value;
            const roomType = document.getElementById('room-type').value;
            if (!checkIn || !checkOut || !guests || !roomType) {
                alert('Please fill in all booking details.');
                return;
            }
            // Fetch all bookings for the selected type and date range
            Promise.all([
                fetch('admin/rooms_crud.php?action=read').then(res => res.json()),
                fetch('admin/bookings_crud.php?action=read').then(res => res.json())
            ]).then(([rooms, bookings]) => {
                // Flexible type matching
                function typeMatches(selected, dbType) {
                    selected = selected.toLowerCase();
                    dbType = dbType.toLowerCase();
                    if (selected === 'standard room' && (dbType === 'standard' || dbType === 'standard room')) return true;
                    if (selected === 'deluxe room' && dbType.includes('deluxe')) return true;
                    if (selected === 'executive suite' && dbType.includes('executive')) return true;
                    if (selected === 'presidential suite' && dbType.includes('presidential')) return true;
                    // fallback: partial match
                    return dbType.includes(selected.split(' ')[0]);
                }
                // Helper to check if two date ranges overlap
                function isOverlap(aStart, aEnd, bStart, bEnd) {
                    return (aStart <= bEnd) && (bStart <= aEnd);
                }
                // Find booked room_ids for this type and date range
                let bookedRoomIds = new Set();
                bookings.forEach(b => {
                    if (!b.room_id) return;
                    if (!b.room_type || !typeMatches(roomType, b.room_type)) return;
                    // Only consider bookings that overlap with selected dates and are not cancelled
                    if (b.status && b.status.toLowerCase() === 'cancelled') return;
                    if (isOverlap(
                        new Date(checkIn), new Date(checkOut),
                        new Date(b.check_in), new Date(b.check_out)
                    )) {
                        bookedRoomIds.add(String(b.room_id));
                    }
                });
                let availableRooms = rooms.filter(room => {
                    let matchType = typeMatches(roomType, room.type);
                    let isAvailable = room.status.toLowerCase() === 'available';
                    let notBooked = !bookedRoomIds.has(String(room.id));
                    return matchType && isAvailable && notBooked;
                });
                showAvailableRooms(availableRooms, checkIn, checkOut, guests);
            }).catch(() => alert('Could not check room availability.'));
        // Scroll to rooms section when 'Explore Our Rooms' is clicked
        document.querySelectorAll('a.btn').forEach(btn => {
            if (btn.textContent.trim().toLowerCase().includes('explore')) {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelector('.rooms').scrollIntoView({behavior:'smooth'});
                });
            }
        });
        });

        // Helper to show available rooms and Book Now button
        function showAvailableRooms(rooms, checkIn, checkOut, guests) {
            let modal = document.getElementById('availableRoomsModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'availableRoomsModal';
                modal.innerHTML = `
                <div style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.5);z-index:9999;display:flex;align-items:center;justify-content:center;">
                  <div style="background:#fff;padding:30px;max-width:800px;width:90vw;max-height:90vh;overflow:auto;position:relative;">
                    <button id="closeRoomsModal" style="position:absolute;top:10px;right:10px;font-size:20px;">&times;</button>
                    <h2>Available Rooms</h2>
                    <div id="roomsList"></div>
                  </div>
                </div>`;
                document.body.appendChild(modal);
            }
            // Fill rooms
            const roomsList = modal.querySelector('#roomsList');
            if (rooms.length === 0) {
                roomsList.innerHTML = '<p>No rooms available for your selection.</p>';
            } else {
                roomsList.innerHTML = rooms.map(room => {
                    let imgSrc = (room.images && JSON.parse(room.images)[0]) ? ('admin/uploads/' + JSON.parse(room.images)[0]) : 'https://via.placeholder.com/400x250?text=No+Image';
                    let features = [];
                    try { features = JSON.parse(room.features || '[]'); } catch(e) { features = []; }
                    return `
                    <div class="room-card mb-4 p-3 border rounded">
                        <div class="row">
                            <div class="col-md-4"><img src="${imgSrc}" alt="${room.name}" class="img-fluid rounded"></div>
                            <div class="col-md-8">
                                <h4>${room.name}</h4>
                                <div><strong>Type:</strong> ${room.type}</div>
                                <div><strong>Price:</strong> $${room.price}</div>
                                <div><strong>Capacity:</strong> ${room.capacity}</div>
                                <div><strong>Features:</strong> ${features.join(', ')}</div>
                                <div><strong>Description:</strong> ${room.description}</div>
                                <button class="btn btn-success mt-2 book-now-btn" data-room-id="${room.id}">Book Now</button>
                            </div>
                        </div>
                    </div>
                    `;
                }).join('');
                // Add event listeners for Book Now buttons
                setTimeout(() => {
                    modal.querySelectorAll('.book-now-btn').forEach((btn, idx) => {
                        btn.onclick = function() {
                            let room = rooms[idx];
                            showBookingForm(room.type, checkIn, checkOut, guests, room.id);
                        };
                    });
                }, 100);
            }
            // Close modal
            modal.querySelector('#closeRoomsModal').onclick = function() {
                modal.remove();
            };
            modal.style.display = 'flex';
        }

        // Show booking form/modal (simple version)
        function showBookingForm(roomType, checkIn, checkOut, guests, roomId) {
            let modal = document.getElementById('bookingFormModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'bookingFormModal';
                modal.innerHTML = `
                <div style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.5);z-index:10000;display:flex;align-items:center;justify-content:center;">
                  <div style="background:#fff;padding:30px;max-width:400px;width:90vw;position:relative;">
                    <button id="closeBookingFormModal" style="position:absolute;top:10px;right:10px;font-size:20px;">&times;</button>
                    <h2>Book Room</h2>
                    <form id="bookingForm">
                      <input type="hidden" name="room_id" value="${roomId || ''}">
                      <div class="form-group"><label>Room Type</label><input type="text" class="form-control" name="room_type" value="${roomType}" readonly></div>
                      <div class="form-group"><label>Check In</label><input type="date" class="form-control" name="check_in" value="${checkIn}" readonly></div>
                      <div class="form-group"><label>Check Out</label><input type="date" class="form-control" name="check_out" value="${checkOut}" readonly></div>
                      <div class="form-group"><label>Guests</label><input type="text" class="form-control" name="guests" value="${guests}" readonly></div>
                      <div class="form-group"><label>Your Name</label><input type="text" class="form-control" name="guest_name" required></div>
                      <div class="form-group"><label>Email</label><input type="email" class="form-control" name="email" required></div>
                      <div class="form-group"><label>Phone</label><input type="tel" class="form-control" name="phone" required></div>
                      <button type="submit" class="btn btn-primary btn-block">Confirm Booking</button>
                    </form>
                  </div>
                </div>`;
                document.body.appendChild(modal);
            }
            // Close modal
            modal.querySelector('#closeBookingFormModal').onclick = function() {
                modal.remove();
            };
            // Handle booking form submit
            modal.querySelector('#bookingForm').onsubmit = function(e) {
                e.preventDefault();
                const form = e.target;
                const data = new FormData(form);
                data.append('action', 'create');
                fetch('admin/bookings_crud.php', {
                    method: 'POST',
                    body: data
                })
                .then(res => res.json())
                .then(res => {
                    if (res.success) {
                        alert('Booking confirmed!');
                        modal.remove();
                        let availModal = document.getElementById('availableRoomsModal');
                        if (availModal) availModal.remove();
                    } else {
                        alert(res.message || 'Booking failed.');
                    }
                })
                .catch(() => alert('Booking failed.'));
            };
            modal.style.display = 'flex';
        }
    </script>
</body>
</html>